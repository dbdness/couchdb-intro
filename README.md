# CouchDB Intro: operating with cURL

*Written by Danny*

[CouchDB](http://couchdb.apache.org/) is an open source NoSQL document-based database by Apache.

CouchDB's CRUD commands are accessed via. the base database instance URL (using a built-in REST API). There are multiple ways to query the database, but the primary ways are using the command line tool [cURL](https://github.com/curl/curl), or the UI [Futon](http://guide.couchdb.org/draft/tour.html#welcome). **In this guide, I will only be demonstrating the cURL commands.**

## Quickstart

### Creating a CouchDB instance

Use the following command to get started quickly using Docker. This avoids the whole installation and setup process of CouchDB - The executed Docker image handles all of this for us:

```bash
docker run -p 5984:5984 -d couchdb
```

This command also exposes the default CouchDB 5984 port to our host machine. That means that we can query the database using localhost directly, while our Docker container is running in the background.

### Creating a database

Use the following command to create a new database with a name of your choice:

```bash
$ curl -X PUT localhost:5984/*database_name*
```

Example:

```bash
$ curl -X PUT localhost:5984/firstdb

{"ok":true}
```

**Note: database names must be all lowercase.**

You can verify that you've created the database correctly by using a GET-request towards the `_all_dbs` url like so:

```bash
$ curl -X GET localhost:5984/_all_dbs 

["firstdb"]
```

### Creating a document

It's time to create our first document. The command looks like this:

```bash
$ curl -X PUT localhost:5984/*database_name*/"*id*" -d '{*document*}'
```

This will create a document with the specified id and document inside the specified database. 

Example:

```bash
$ curl -X PUT localhost:5984/firstdb/"1" -d 
'{ "Name" : "John Doe", "Age" : "23" }'

{"ok":true,"id":"1","rev":"1-923d01327f79de423d2357c090d264f7"}
```

**Note: it's very important that you format your JSON document exactly like it's shown above. Otherwise you may encounter a bad_request response from CouchDB** 

### Fetching a document

Now you can easily get your created document back by running a GET command like this:

```bash
$ curl -X GET localhost:5984/*document_name*/*id*
```

Example:

```bash
$ curl -X GET localhost:5984/firstdb/1

{"_id":"1","_rev":"1-923d01327f79de423d2357c090d264f7"," Name ":" John Doe "," Age ":" 23 
"}
```

### Updating a document

Before we can update an existing document, it's important to consider one of the values in our document from before. That is, the `"_rev"` field. This is the revision field, and contains an unique value for the document that will be autogenerated each time the document is updated/modified:

This revision value is needed when updating or deleting a document:

```bash
$ curl -X PUT localhost:5984/*database_name*/*document_id*/ -d '{ "field" : "value", "_rev" : "revision id" }'
```

Now let's update the age in our document from before: 

```bash
$ curl -X PUT localhost:5984/firstdb/1 -d 
'{ "Name" : "Jane Doe" , "Age" : "30" , "_rev" : "1-923d01327f79de423d2357c090d264f7"}'

{"ok":true,"id":"1","rev":"2-fb195214f981cf47b18403ee528311e3"}
```

Notice that a new revision ID is now assigned to that document. The new revision ID is needed when you want to update the document again. 

### Deleting a document

As before, we need the revision ID of the document we want to delete. We will send a DELETE request along with the revision ID and the URL of the document to be deleted. It has the following syntax:

```bash
$ curl -X DELETE localhost:5984/*database_name*/*document_id*?rev=*_rev*
```

Example:

```bash
curl -X DELETE localhost:5984/firstdb/1?rev=2-fb195214f981cf47b18403ee528311e3

{"ok":true,"id":"1","rev":"3-400869aaadee2da6c2c212e49cb82ac0"}
```

### Deleting a database

It's also possible to delete an entire database completely. Here is the syntax for doing that:

```bash
$ curl -X DELETE localhost:5984/database_name
```

Example:

```bash
$ curl -X DELETE localhost:5984/firstdb

{"ok":true}
```

We can verify that the database has been successfully deleted by running the `_all_dbs` command from earlier:

```bash
$ curl -X GET localhost:5984/_all_dbs

[]
```

